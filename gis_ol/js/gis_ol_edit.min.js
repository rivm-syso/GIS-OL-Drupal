var gis_ol_default_row=new Array( 'WMS', 'https://geodata.rivm.nl/geoserver/wms', '', '', '1', 'Off', '0', '', '', 'vstyle'); var default_parameters={ 'dataversie': 0, 'a': 1.2, 'u': 'automatisch', 'fl': 0, 'b': '111', 'o': '000', 'z': 0, 'e': 1, 'p': 0, 'pz': 10, 'f': 1, 'l': '1100010', 'l1': 0, 'sb': 0, 'c': 0, 'ts': 0, 'i': 2000, 'm': '', 'w1': 0, 'w2': 1, 'tl': 0, 'fg': '01', 'ld': '', 'tmp': '0'}; var gis_ol_modals=[]; function getParmValue(parm) { var parmsplit=parm.split('-'), r, body=jQuery('#edit-gis-ol-body-0-value'),regels=body.val(), t, pos,v; if (regels=='') {regels=[];} else {regels=regels.replace(/[\r\n]+/g,"\r"); regels=regels.replace(/\n+/g,"\r"); regels=regels.split("\r");} for (t=0;t<regels.length;t++) { pos=regels[t].indexOf('='); if (regels[t].substr(0,pos)==parmsplit[0]) { v=regels[t].substr(pos+1); if (parmsplit.length==2) { r=v.substr(parseInt(parmsplit[1],10),1); } else { r=v; } return r; } } return ''; } function regel_p() {if (getParmValue('p')==1) {jQuery('#gis_ol_pz_div').show();} else {jQuery('#gis_ol_pz_div').hide();}} function regel_fg() {if (getParmValue('fg').substr(0,1)==1) {jQuery('.gis_ol_fg1').show();} else {jQuery('.gis_ol_fg1').hide();}} function regel_l() {if (getParmValue('l').substr(0,1)==1) {jQuery('.gis_ol_l_1').show();} else {jQuery('.gis_ol_l_1').hide();}} function regel_ts() {if (getParmValue('ts')>=1) {jQuery('.gis_ol_ts_1').show();} else {jQuery('.gis_ol_ts_1').hide();}} function gis_ol_change() { var el=jQuery(this), parm=el.attr('gis_ol'), parmsplit=parm.split('-'), body=jQuery('#edit-gis-ol-body-0-value'),regels=body.val(), t, regel, pos, old_value, parm; if (regels=='') {regels=[];} else {regels=regels.replace(/[\r\n]+/g,"\r"); regels=regels.replace(/\n+/g,"\r"); regels=regels.split("\r");} for (t=0, regel=regels.length;t<regels.length;t++) { pos=regels[t].indexOf('='); if (pos>=1 && regels[t].substr(0,pos)==parmsplit[0]) {regel=t; parm=regels[t].substr(0,pos); t=regels.length;} } if (parmsplit.length==2) { var parmsplitno=parseInt(parmsplit[1],10); if (regel>=regels.length || regels[regel]=='') {old_value='';} else {old_value=regels[regel].substr(parm.length+1);} while (old_value.length<parmsplitno) {old_value+=' ';} if (el.prop('type')=='checkbox') { regels[regel]=parmsplit[0]+'='+old_value.substr(0,parmsplitno)+(el.prop('checked')?'1':'0')+old_value.substr(parmsplitno+1); } else { regels[regel]=parmsplit[0]+'='+old_value.substr(0,parmsplitno)+el.val()+old_value.substr(parmsplitno+1); } } else { if (el.prop('type')=='checkbox') { regels[regel]=parm+'='+(el.prop('checked')?'1':'0'); } else { regels[regel]=parm+'='+el.val(); } } body.val(regels.join("\r")); if (parm=='p') {regel_p();} if (parm=='fg') {regel_fg();} if (parm=='l') {regel_l();} if (parm=='ts') {regel_ts();} } function getLayerDefs() { var layer_defs=jQuery('#edit-gis-ol-layer-definities-0-value'),t=layer_defs.val(); t=t.replace(/[\r\n]+/g,"\r"); t=t.replace(/\n+/g,"\r"); t=t.split("\r"); var tbl='<div id="gis_ol_div"><table class="field-multiple-table responsive-enabled"><thead><tr><th>Pos.</th><th>Type</th><th>Layer</th><th>Layernaam (in Drupal)</th><th>Opacity</th><th>Initi&euml;el</th><th>Features</th><th></th><th></th></tr></thead><tbody>',t1; for (t1=0;t1<t.length;t1++) if (t[t1]!='') { tbl+=gis_ol_row(t1,t[t1].split('|'),t.length+(t[t.length-1]==''?-1:0)); } tbl+='</tbody></table>'; tbl+='<input onclick="gis_ol_add();" type="button" value="Layer-definitie toevoegen" class="button js-form-submit form-submit" style="margin: 12px 0 20px 0;">'; tbl+='</div>'; return tbl; } function redrawLayerDefsTable() { jQuery('#gis_ol_layer_defs').html(getLayerDefs()); } function gis_ol_init() { jQuery('.form-item-gis-ol-body-0-value').hide(); jQuery('.form-item-gis-ol-layer-definities-0-value').hide(); var wms = drupalSettings.gis_ol.wms.split('|'), t1,s1; var wmsDom='<div style="min-width: 600px;"><table style="width: initial;"><tr><td>Zoek:</td><td><input size="24" onkeyup="gis_ol_zoek(\'wms\');" id="gis_ol_zoek_wms"></td></tr><tr><td style="vertical-align: top;">Layer:</td><td><div style="max-height: 14em; overflow-y: scroll;"><table id="gis_ol_res_wms" style="min-width: 100%;">'; for (t1=0;t1<wms.length;t1++) { s1=wms[t1].split('='); wmsDom+='<tr style="display: none; border: none;"><td style="padding: 0;"><input type="radio" name="gis_ol_res_wms" id="gis_ol_res_wms_'+t1+'" value="'+wms[t1]+'" onchange="gis_ol_zoek(\'wms\');"></td><td style="padding: 0 0 0 20px;"> <label for="gis_ol_res_wms_'+t1+'"> '+s1[0]+'</label></td></tr>'; } wmsDom+='</table></div></td></tr></table><div><input type="button" value="Ok" onclick="gis_ol_modals_close=true;gis_ol_modals[\'WMS\'].close();" class="button buton--primary js-form-submit form-submit" id="gis_ol_ok_wms"><input type="button" value="Cancel" onclick="gis_ol_modals[\'WMS\'].close();" class="button js-form-submit form-submit"></div></div>'; wmsDom=jQuery(wmsDom); gis_ol_modals['WMS'] = Drupal.dialog(wmsDom, { closeOnEscape: true, title:'Kies WMS layer', width: 'auto', beforeClose: function () { if (gis_ol_modals_close) { var layer=gis_ol_modals_value.split('='),title=layer[1];layer=layer[0]; gis_ol_setOneValue(gis_ol_setLayerRow,2,layer); jQuery('#gis_ol_layer_'+gis_ol_setLayerRow).html(layer); gis_ol_setOneValue(gis_ol_setLayerRow,3,title); jQuery('#gis_ol_title_'+gis_ol_setLayerRow).val(title); } }, }); var wmsDom2='<div style="min-width: 600px;"><table style="width: initial;"><tr><td>Zoek:</td><td><input size="24" onkeyup="gis_ol_zoek(\'wmsinput\');" id="gis_ol_zoek_wmsinput"></td></tr><tr><td style="vertical-align: top;">Layer:</td><td><div style="max-height: 14em; overflow-y: scroll;"><table id="gis_ol_res_wmsinput" style="min-width: 100%;">'; for (t1=0;t1<wms.length;t1++) { s1=wms[t1].split('='); wmsDom2+='<tr style="display: none; border: none;"><td style="padding: 0;"><input type="radio" name="gis_ol_res_wmsinput" id="gis_ol_res_wmsinput_'+t1+'" value="'+wms[t1]+'" onchange="gis_ol_zoek(\'wmsinput\');"></td><td style="padding: 0 0 0 20px;"> <label for="gis_ol_res_wmsinput_'+t1+'"> '+s1[0]+'</label></td></tr>'; } wmsDom2+='</table></div></td></tr></table><div><input type="button" value="Ok" onclick="gis_ol_modals_close=true;gis_ol_modals[\'WMSinput\'].close();" class="button buton--primary js-form-submit form-submit" id="gis_ol_ok_wmsinput"><input type="button" value="Cancel" onclick="gis_ol_modals[\'WMSinput\'].close();" class="button js-form-submit form-submit"></div></div>'; wmsDom2=jQuery(wmsDom2); gis_ol_modals['WMSinput'] = Drupal.dialog(wmsDom2, { closeOnEscape: true, title:'Kies WMS input layer', width: 'auto', beforeClose: function () { if (gis_ol_modals_close) { var layer=gis_ol_modals_value.split('='),title=layer[1];layer=layer[0]; gis_ol_setOneValue(gis_ol_setLayerRow,2,layer); jQuery('#gis_ol_layer_'+gis_ol_setLayerRow).html(layer); gis_ol_setOneValue(gis_ol_setLayerRow,3,title); jQuery('#gis_ol_title_'+gis_ol_setLayerRow).val(title); } }, }); var wms = drupalSettings.gis_ol.datarivmnl.split('|'), t1,s1; var wmsDom3='<div style="min-width: 600px;"><table style="width: initial;"><tr><td>Zoek:</td><td><input size="24" onkeyup="gis_ol_zoek(\'datarivmnl\');" id="gis_ol_zoek_datarivmnl"></td></tr><tr><td style="vertical-align: top;">Layer:</td><td><div style="max-height: 14em; overflow-y: scroll;"><table id="gis_ol_res_datarivmnl" style="min-width: 100%;">'; for (t1=0;t1<wms.length;t1++) { s1=wms[t1].split('='); wmsDom3+='<tr style="display: none; border: none;"><td style="padding: 0;"><input type="radio" name="gis_ol_res_datarivmnl" id="gis_ol_res_datarivmnl_'+t1+'" value="'+wms[t1]+'" onchange="gis_ol_zoek(\'datarivmnl\');"></td><td style="padding: 0 0 0 20px;"> <label for="gis_ol_res_datarivmnl_'+t1+'"> '+s1[2]+'</label></td></tr>'; } wmsDom3+='</table></div></td></tr></table><div><input type="button" value="Ok" onclick="gis_ol_modals_close=true;gis_ol_modals[\'datarivmnl\'].close();" class="button buton--primary js-form-submit form-submit" id="gis_ol_ok_datarivmnl"><input type="button" value="Cancel" onclick="gis_ol_modals[\'datarivmnl\'].close();" class="button js-form-submit form-submit"></div></div>'; wmsDom3=jQuery(wmsDom3); gis_ol_modals['datarivmnl'] = Drupal.dialog(wmsDom3, { closeOnEscape: true, title:'Kies layer', width: 'auto', beforeClose: function () { if (gis_ol_modals_close) { var layer=gis_ol_modals_value.split('='),server=layer[0],title=layer[1]; layer=layer[2]; gis_ol_setOneValue(gis_ol_setLayerRow,1,server); gis_ol_setOneValue(gis_ol_setLayerRow,2,layer); jQuery('#gis_ol_layer_'+gis_ol_setLayerRow).html(layer); gis_ol_setOneValue(gis_ol_setLayerRow,3,title); jQuery('#gis_ol_title_'+gis_ol_setLayerRow).val(title); } }, }); wms = drupalSettings.gis_ol.vectortile.split('|'); var wmsDom4='<div style="min-width: 600px;"><table style="width: initial;"><tr><td>Zoek:</td><td><input size="24" onkeyup="gis_ol_zoek(\'vectortile\');" id="gis_ol_zoek_vectortile"></td></tr><tr><td style="vertical-align: top;">Layer:</td><td><div style="max-height: 14em; overflow-y: scroll;"><table id="gis_ol_res_vectortile" style="min-width: 100%;">'; for (t1=0;t1<wms.length;t1++) { s1=wms[t1].split('='); wmsDom4+='<tr style="display: none; border: none;"><td style="padding: 0;"><input type="radio" name="gis_ol_res_vectortile" id="gis_ol_res_vectortile_'+t1+'" value="'+wms[t1]+'" onchange="gis_ol_zoek(\'vectortile\');"></td><td style="padding: 0 0 0 20px;"> <label for="gis_ol_res_vectortile_'+t1+'"> '+s1[0]+'</label></td></tr>'; } wmsDom4+='</table></div></td></tr></table><div><input type="button" value="Ok" onclick="gis_ol_modals_close=true;gis_ol_modals[\'Vectortile\'].close();" class="button buton--primary js-form-submit form-submit" id="gis_ol_ok_vectortile"><input type="button" value="Cancel" onclick="gis_ol_modals[\'Vectortile\'].close();" class="button js-form-submit form-submit"></div></div>'; wmsDom4=jQuery(wmsDom4); gis_ol_modals['Vectortile'] = Drupal.dialog(wmsDom4, { closeOnEscape: true, title:'Kies input vector layer', width: 'auto', beforeClose: function () { if (gis_ol_modals_close) { var layer=gis_ol_modals_value.split('='),title=layer[1];layer=layer[0]; gis_ol_setOneValue(gis_ol_setLayerRow,2,layer); jQuery('#gis_ol_layer_'+gis_ol_setLayerRow).html(layer); gis_ol_setOneValue(gis_ol_setLayerRow,3,title); jQuery('#gis_ol_title_'+gis_ol_setLayerRow).val(title); } }, }); var body=jQuery('#edit-gis-ol-body-0-value'); if (body.val()=='') { var key, v=''; for (key in default_parameters) { if (!default_parameters.hasOwnProperty(key)) continue; if (key!='u' && key!='ld') { v+=(v==''?'':String.fromCharCode(13))+key+'='+default_parameters[key]; } } body.val(v); } else { var regels=body.val(), t, regel, pos, parm, key; regels=regels.replace(/[\r\n]+/g,"\r"); regels=regels.replace(/\n+/g,"\r"); regels=regels.split("\r"); for (t=regels.length-1;t>=0;t--) { pos=regels[t].indexOf('='); parm=regels[t].substr(0,pos); if (parm=='ld' || !default_parameters.hasOwnProperty(parm)) {regels.splice(t,1);} } for (key in default_parameters) { if (key=='u' || key=='ld' || (key!='tmp' && !default_parameters.hasOwnProperty(key))) continue; for (t=0,regel=-1;t<regels.length;t++) { pos=regels[t].indexOf('='); parm=regels[t].substr(0,pos); if (key==parm) {regel=t; t=regels.length;} } if (regel==-1) { regels[regels.length]=key+'='+default_parameters[key]; } else { if (key=='tmp') { regels[regel]=key+'='+default_parameters[key]; } else { if (typeof(default_parameters[key])=='string') { regels[regel]+=default_parameters[key].substr(regels[regel].length); } } } } body.val(regels.join("\r")); } var start_el=jQuery('.layout-region.layout-region-node-main'),d='',href=window.location.href; href=href.substr(0,href.indexOf('/node'))+'/gis_ol?help'; kleuren=['Automatisch','Bruin','Donkerblauw','Donkerbruin','Donkergeel','Donkergroen','Geel','Groen','Hemelblauw','Lichtblauw','Mintgroen','Mosgroen','Oranje','Paars','Robijnrood','Rood','Roze','Violet','Wit']; d+='<div class="form-item"><b>Formaat en uiterlijk</b><div class="links" style="float: right;cursor: pointer;"><a onclick="window.open(\''+href+'#form\',\'gis_ol_help\');" class="module-link module-link-help" title="Help">Help</a></div>'; d+='<table class="gis_ol_edit_table">'; d+='<tr><td>Aspect ratio:</td><td><input type="number" min="0.8" max="2" step="0.1" class="form-number" gis_ol="a"></td><td></td><td>Kleurstelling:</td><td><select gis_ol="u">'; for (t1=0;t1<kleuren.length;t1++) { d+='<option value="'+kleuren[t1].toLowerCase()+'">'+kleuren[t1]+'</option>'; } d+='</select></td></tr>'; d+='</table>'; d+='</div>'; d+='<div class="form-item"><b style="padding-bottom: 10px; display: block;">Basiskaarten</b><div class="links" style="float: right;cursor: pointer;"><a onclick="window.open(\''+href+'#basis\',\'gis_ol_help\');" class="module-link module-link-help" title="Help">Help</a></div>'; d+='<div>'; d+='<input type="checkbox" id="gis_ol_bk1" class="form-checkbox" gis_ol="b-0" checked="checked"><label for="gis_ol_bk1" class="option"> Openbasiskaart</label>'; d+='<input type="checkbox" id="gis_ol_bk2" class="form-checkbox" style="margin-left: 40px;" gis_ol="b-1"><label for="gis_ol_bk2" class="option"> Luchtfoto</label>'; d+='<input type="checkbox" id="gis_ol_bk3" class="form-checkbox" style="margin-left: 40px;" gis_ol="b-2"><label for="gis_ol_bk3" class="option"> Topografisch</label>'; d+='</div>'; d+='<div class="description">Vink de basiskaarten aan die moeten worden opgenomen.</div>'; d+='</div>'; d+='<div class="form-item"><b style="padding-bottom: 10px; display: block;">Overlaykaarten</b><div class="links" style="float: right;cursor: pointer;"><a onclick="window.open(\''+href+'#basis\',\'gis_ol_help\');" class="module-link module-link-help" title="Help">Help</a></div>'; d+='<div>'; d+='<input type="checkbox" id="gis_ol_ok1" class="form-checkbox" gis_ol="o-0" checked="checked"><label for="gis_ol_ok1" class="option"> NL schaduw</label>'; d+='<input type="checkbox" id="gis_ol_ok2" class="form-checkbox" style="margin-left: 40px;" gis_ol="o-1"><label for="gis_ol_ok2" class="option"> Provinciegrenzen</label>'; d+='<input type="checkbox" id="gis_ol_ok3" class="form-checkbox" style="margin-left: 40px;" gis_ol="o-2"><label for="gis_ol_ok3" class="option"> Gemeentegrenzen</label>'; d+='</div>'; d+='<div class="description">Vink de overlaykaarten aan die moeten worden opgenomen.</div>'; d+='</div>'; d+='<div class="form-item"><b>Knoppen en overige controls</b><div class="links" style="float: right;cursor: pointer;"><a onclick="window.open(\''+href+'#knop\',\'gis_ol_help\');" class="module-link module-link-help" title="Help">Help</a></div>'; d+='<table class="gis_ol_edit_table"><tr><td style="font-style: italic; vertical-align: top;">Links boven'; d+='<table class="gis_ol_edit_table" style="font-style: normal;">'; d+='<tr><td><input type="checkbox" id="gis_ol_z" gis_ol="z"><label for="gis_ol_z" class="option"> In- en uitzoomen</label></td><td><div><input type="checkbox" id="gis_ol_p" gis_ol="p"><label for="gis_ol_p" class="option"> Locatie zoeker</label></div><div id="gis_ol_pz_div">Zoom level: <input type="number" min="2" max="13" step="1" id="gis_ol_pz" gis_ol="pz"></div></td></tr>'; d+='<tr><td><input type="checkbox" id="gis_ol_e" gis_ol="e"><label for="gis_ol_e" class="option"> Zoom extend</label></td></tr>'; d+='<tr><td><input type="checkbox" id="gis_ol_f" gis_ol="f"><label for="gis_ol_f" class="option"> Full screen</label></td></tr>'; d+='</table>'; d+='</td><td style="font-style: italic;vertical-align: top;">Rechts boven'; d+='<table class="gis_ol_edit_table" style="font-style: normal;">'; d+='<tr><td>Layers:</td><td><select gis_ol="l-0"><option value="0">Nee</option><option value="1">Ja</option></select></td><td class="gis_ol_l_1">Opties:</td><td class="gis_ol_l_1"><select gis_ol="l-1"><option value="0">Slechts 1 laag selecteerbaar</option><option value="1">Elke laag selecteerbaar</option></select></td></tr>'; d+='<tr class="gis_ol_l_1"><td></td><td></td><td></td><td><select gis_ol="l-2"><option value="0">Zonder transparantie-knoppen slider</option><option value="1">Met transparantie-knoppen</option></select</td></tr>'; d+='<tr class="gis_ol_l_1"><td></td><td></td><td></td><td><select gis_ol="l-3"><option value="0">Zonder download mogelijkheid</option><option value="1">Download geheel Nederland</option><option value="2">Download, vraag NL of Bounding Box</option></select</td></tr>'; d+='<tr class="gis_ol_l_1"><td></td><td></td><td></td><td><select gis_ol="l-4"><option value="0">Zonder data.rivm.nl knop</option><option value="1">Met data.rivm.nl knop</option></select</td></tr>'; d+='<tr class="gis_ol_l_1"><td></td><td></td><td></td><td><select gis_ol="l-5"><option value="0">Zonder legenda knop</option><option value="1">Met legenda knop</option></select></td></tr>'; d+='<tr class="gis_ol_l_1"><td></td><td></td><td></td><td><select gis_ol="l-6"><option value="0">Knoppen achter laagnaam</option><option value="1">Knoppen onder laagnaam</option></select></td></tr>'; d+='<tr><td><input type="checkbox" id="gis_ol_fg1" gis_ol="fg-0"><label for="gis_ol_fg1" class="option"> Filterknop</label></td><td class="gis_ol_fg1" colspan="2">Filtervelden gedrag:</td><td class="gis_ol_fg1"><select gis_ol="fg-1"><option value="0" selected="selected">Toon alle filters</option><option value="1">1 filter bij gelijke veldnamen</option><option value="2">1 filter bij gelijke labels</option></select></td></tr>'; d+='</table>'; d+='</td></tr><tr><td style="font-style: italic;vertical-align: top;">Links onder'; d+='<table class="gis_ol_edit_table" style="font-style: normal;">'; d+='<tr><td><input type="checkbox" id="gis_ol_l1" gis_ol="l1"><label for="gis_ol_l1" class="option"> Legenda (indien 1 layer selecteerbaar)</label></td></tr>'; d+='<tr><td><input type="checkbox" id="gis_ol_sb" gis_ol="sb"><label for="gis_ol_sb" class="option"> Scalebar</label></td></tr>'; d+='<tr><td><input type="checkbox" id="gis_ol_c" gis_ol="c"><label for="gis_ol_c" class="option"> Co&ouml;rdinaten</label></td></tr>'; d+='</table>'; d+='</td><td style="font-style: italic;vertical-align: top;">Rechts onder'; d+='<table class="gis_ol_edit_table" style="font-style: normal;">'; d+='<tr><td>Timeslider:</td><td><select gis_ol="ts"><option value="0">Nee</option><option value="1">Ja</option><option value="2">Ja, incl. play-knop</option></select></td><td class="gis_ol_ts_1">Interval:</td><td class="gis_ol_ts_1"><input type="number" min="500" max="5000" step="500" class="form-number" gis_ol="i"></td></tr>'; d+='</table>'; d+='</td></tr></table>'; d+='</div>'; d+='<b style="display: block;">Layer definities</b><div class="links" style="float: right;cursor: pointer;"><a onclick="window.open(\''+href+'#layer\',\'gis_ol_help\');" class="module-link module-link-help" title="Help">Help</a></div>'; d+='<div><input type="checkbox" id="gis_ol_tmp-0" gis_ol="tmp-0"><label for="gis_ol_tmp-0" class="option"> Cache met laag-informatie legen.</label></div>'; d+='<div id="gis_ol_layer_defs">'+getLayerDefs()+'</div>'; d+='<div class="form-item"><b>Data weergave</b><div class="links" style="float: right;cursor: pointer;"><a onclick="window.open(\''+href+'#data\',\'gis_ol_help\');" class="module-link module-link-help" title="Help">Help</a></div>'; d+='<table class="gis_ol_edit_table">'; d+='<tr><td>Positie data-window:</td><td><select gis_ol="w1"><option value="0">Rechts boven muisklik, binnen de kaart</option><option value="1">Indien mogelijk onder de muisklik en over de pagina</option></select></td></tr>'; d+='<tr><td>Melding bij \'geen data\':</td><td><input gis_ol="m" style="width: 100%;"></td></tr>'; d+='<tr><td>Ordening bij meerdere lagen/features:</td><td><select gis_ol="w2"><option value="0">Lagen en features vertikaal</option><option value="1">Lagen horizontaal, features vertikaal</option><option value="2">Lagen vertikaal, features horizontaal</option><option value="3">Kruistabel Lagen horizontaal, properties vertikaal</option><option value="4">Kruistabel Lagen vertikaal, properties horizontaal</option></select></td></tr>'; d+='<tr><td><input type="checkbox" id="gis_ol_tl" gis_ol="tl"><label for="gis_ol_tl" class="option"> Toon laagnaam bij features</label></td></tr>'; d+='</table>'; d+='</div>'; start_el.append(d); var els=jQuery('[gis_ol]').each(function (t,el) { el=jQuery(el); var v=getParmValue(el.attr('gis_ol')); if (el.prop('type')=='checkbox') { el.prop('checked',v=='1'); } else { if (el.attr('gis_ol')=='u') { if (v!='1') {el.val(v);} } else { el.val(v); } } el.on('change',gis_ol_change); }); } function gis_ol_zoek(typ) { var z=jQuery('#gis_ol_zoek_'+typ).val(), opts=jQuery('#gis_ol_res_'+typ), t, hasSel=false, tr, chk,lbl; if (opts.length==1) {opts=opts[0].rows;} else {opts='';} if (typeof(z)=='undefined') {z='';} else {z=z.toLowerCase();} if (opts) for (t=0;t<opts.length;t++) { tr=jQuery(opts[t]).children(); chk=jQuery(jQuery(tr[0]).children()[0]); lbl=jQuery(jQuery(tr[1]).children()[0]); if (z!='' && lbl.html().toLowerCase().indexOf(z)>=0) { jQuery(opts[t]).show(); if (chk.prop('checked')) {hasSel=true; gis_ol_modals_value=chk.val();} } else { jQuery(opts[t]).hide(); } } if (hasSel) { jQuery('#gis_ol_ok_'+typ).removeAttr('disabled'); } else { jQuery('#gis_ol_ok_'+typ).attr('disabled','disabled'); } } function gis_ol_getSelect(values,value,onchange) { var s='<select onchange="'+onchange+'">',t,s1; for (t=0;t<values.length;t++) { s1=values[t].split('='); if (s1.length==1) {s1[1]=s1[0];} s+='<option value="'+s1[0]+'"'+(s1[0]==''+value?' selected="selected"':'')+'>'+s1[1]+'</option>'; } return s+'</select>'; } function gis_ol_changePos(no,aant_rows,to_no) { to_no=parseInt(to_no,10); if (no!=to_no) { var el=jQuery('#edit-gis-ol-layer-definities-0-value'),t=el.val(),s; t=t.replace(/[\r\n]+/g,"\r"); t=t.replace(/\n+/g,"\r"); t=t.split("\r"); s=t[no]; t.splice(no,1); t.splice(to_no,0,s); el.val(t.join("\r")); redrawLayerDefsTable(); } } function gis_ol_row(no,values,aant_rows) { var a=[],t; for (t=1;t<=aant_rows;t++) {a[t-1]=(t-1)+'='+t;} for (t=0;t<gis_ol_default_row.length;t++) if (typeof(values[t])=='undefined') {values[t]='';} var inp_win=values[8].split('^'); while (inp_win.length<10) {inp_win[inp_win.length]='';} var lstyle=values[9].split('^'); var row='<tr>'; row+='<td>'+gis_ol_getSelect(a,no,'gis_ol_changePos('+no+','+aant_rows+',this.value)')+'</td>'; row+='<td><select onchange="gis_ol_setOneValue('+no+',0,this.value);">'; row+='<option'+(values[0]=='WMS'?' selected="selected"':'')+' value="WMS">WMS</option>'; row+='<option'+(values[0]=='WMSinput'?' selected="selected"':'')+' value="WMSinput">WMS (input)</option>'; row+='<option'+(values[0]=='datarivmnl'?' selected="selected"':'')+' value="datarivmnl">data.rivm.nl</option>'; row+='<option'+(values[0]=='Vectortile'?' selected="selected"':'')+' value="Vectortile">Vector tile</option>'; row+='</select></td>'; row+='<td><select onclick="gis_ol_setLayer('+no+');"><option id="gis_ol_layer_'+no+'">'+values[2]+'</option></select></td>'; row+='<td><input onchange="gis_ol_setOneValue('+no+',3,this.value);" size="24" value="'+values[3]+'" id="gis_ol_title_'+no+'"></td>'; row+='<td><input onchange="gis_ol_setOneValue('+no+',4,this.value);" size="3" value="'+values[4]+'" type="number" step="0.1" min="0" max="1"></td>'; row+='<td style="white-space: nowrap;"><input type="checkbox" id="gis_ol_vis_'+no+'" '+(values[5]=='On'?' checked="checked"':'')+' onclick="gis_ol_setOneValue('+no+',5,jQuery(this).prop(\'checked\')?\'On\':\'Off\');"><label for="gis_ol_vis_'+no+'" style="display: initial;"> zichtbaar</label></td>'; row+='<td><select onchange="gis_ol_setOneValue('+no+',6,this.value);" ><option value="0"'+(values[6]=='0'?' selected="selected"':'')+'>Nee</option><option value="1"'+(values[6]=='1'?' selected="selected"':'')+'>Toon als laag aan staat</option><option value="2"'+(values[6]=='2'?' selected="selected"':'')+'>Altijd tonen</option></select></td>'; row+='<td><div id="gis_ol_veld_'+no+'" '+(values[6]=='0'?' style="display: none;"':'')+'><select onclick="gis_ol_veld('+no+');"><option>Velden</option></select></div></td>'; row+='<td><input onclick="gis_ol_delete('+no+');" class="button" type="button" value="Verwijder"></td>'; row+='</tr>'; if (values[0]=='WMSinput') { row+='<tr><td></td><td></td><td></td><td style="vertical-align: top;"><b>Invoer window:</b></td><td colspan="4"><table>'; row+='<tr><td>Inleidende tekst</td><td><textarea id="gis_ol_inpwin_'+no+'_0" onchange="gis_ol_setInpWin('+no+',0,this.value);">'+inp_win[0]+'</textarea></td></tr>'; row+='<tr><td>uitleidende tekst</td><td><textarea id="gis_ol_inpwin_'+no+'_1" onchange="gis_ol_setInpWin('+no+',1,this.value);">'+inp_win[1]+'</textarea></td></tr>'; row+='<tr><td>Ok knop</td><td><input id="gis_ol_inpwin_'+no+'_2" onchange="gis_ol_setInpWin('+no+',2,this.value);" value="'+inp_win[2]+'"></td></tr>'; row+='<tr><td>Cancelknop</td><td><input id="gis_ol_inpwin_'+no+'_3" onchange="gis_ol_setInpWin('+no+',3,this.value);" value="'+inp_win[3]+'"></td></tr>'; row+='</table></td></tr>'; } if (values[0]=='Vectortile') { row+='<tr><td></td><td></td><td></td><td colspan="5"><table>'; row+='<tr><td style="vertical-align: top;">Style definitie:</td><td><textarea id="gis_ol_inpwin_'+no+'_0" onchange="gis_ol_setLstyle('+no+',0,this.value);" style="width: 100%;" rows="12">'+lstyle[0].replace(/(\[\-\])/g,"\r")+'</textarea></td></tr>'; row+='</table></td></tr>'; } return row; } var gis_ol_veld_url; function gis_ol_veld(no) { var el=jQuery('#edit-gis-ol-layer-definities-0-value'),t=el.val(),s; t=t.replace(/[\r\n]+/g,"\r"); t=t.replace(/\n+/g,"\r"); t=t.split("\r"); s=t[no].split('|'); if (typeof(s[7])=='undefined') {s[7]='';} if (typeof(s[8])=='undefined') {s[8]='';} var layer; if (s[0]=='Vectortile') { var pos=s[1].indexOf('/gwc/'); if (pos>=1) {s[1]=s[1].substr(0,pos)+'/wms';} } switch (s[0]) { case 'WMS': case 'WMSinput': case 'datarivmnl': case 'Vectortile': layer=new ol.layer.Image({ title: 'title', extent: [-285401.92,22598.08,595401.9199999999,903401.9199999999], source: new ol.source.ImageWMS({ url: s[1], params: { layers: s[2], srs: 'EPSG:28992', format: 'image/png', }, }), }); break; case 'WMTS': break; } var pixpermeter=300000/600; var view=new ol.View({ projection: new ol.proj.Projection({code: 'EPSG:28992',units: 'm'}), center: ol.extent.getCenter([0,300000,300000,650000]), resolution: pixpermeter, maxResolution: pixpermeter, }); var viewResolution = view.getResolution(); var viewProjection = view.getProjection(); var wmsSource=layer.getSource(); gis_ol_veld_url = wmsSource.getGetFeatureInfoUrl([150000,475000],viewResolution, viewProjection, {'FEATURE_COUNT':1, 'INFO_FORMAT': 'application/json', 'QUERY_LAYERS':s[2], 'BUFFER':10000}); jQuery.ajax({ type: 'GET', url: gis_ol_veld_url, data: [], dataType: 'json', }).done(function(data){ if (data.features.length==0) { var url=gis_ol_veld_url,pos1=url.indexOf('&BBOX='),pos2=url.indexOf('&',pos1+1); if (pos2<pos1) {pos2=url.length;} url=url.substr(0,pos1)+'&BBOX=0%2C0%2C300000%2C650000'+url.substr(pos2); jQuery.ajax({ type: 'GET', url: url, data: [], dataType: 'json', }).done(function(data){ if (data.features.length==0) { alert('Kan de velddefinities niet ophalen.'); } else { gis_ol_veld_(no,s,data); } }).fail(function(xhr, textStatus, errorThrown) { alert('Kan de velddefinities niet ophalen. Fout: '+xhr.statusText +' '+ xhr.responseText); }); } else { gis_ol_veld_(no,s,data); } }).fail(function(xhr, textStatus, errorThrown) { alert('Kan de velddefinities niet ophalen. Fout: '+xhr.statusText +' '+ xhr.responseText); }); } var gis_ol_velden_modal, gis_ol_velden_modal_close; function gis_ol_veld_(no,s,data) { var velden=[]; data=data.features; var el=jQuery('#gis_ol_veld_def_'+no),t,veld_s, veld_s2=[],v,k,s2; var html='<h3>'+s[2]+'</h3><table><thead><tr><th>Veldnaam</th><th>Label<sup>*</sup></th><th>Eenheid</th><th>Align</th><th>Filter</th>'; if (s[0]=='WMSinput') {html+='<th>Input type</th>';} html+='</tr></thead><tbody>'; if (typeof(s[7])!='undefined') {veld_s=s[7];} veld_s=veld_s.split(','); for (t=0;t<veld_s.length;t++) { k=veld_s[t].indexOf('='); v=veld_s[t].substr(k+1); k=veld_s[t].substr(0,k); veld_s2[k]=v; } t=0; for (var ft=0;ft<data.length;ft++) { for (var key in data[ft].properties) { s2=(typeof(veld_s2[key])!='undefined'?veld_s2[key]:'^^').split('^'); if (s2.length==1) {s2[1]=''; s2[2]=0; s2[3]='';} if (s2.length<5) {s2[4]='';} if (s2.length<6) {s2[5]='';} html+='<tr><td>'+key; if (s[0]!='WMSinput') {html+='<input id="gis_ol_veld_inp_'+no+'_'+t+'" value="'+s2[5]+'" type="hidden">';} html+='</td><td><input size="12" id="gis_ol_veld_prop_'+no+'_'+t+'" value="'+s2[0]+'"></td><td><input size="6" id="gis_ol_veld_prop2_'+no+'_'+t+'" value="'+s2[1]+'"></td><td><input type="checkbox" id="gis_ol_veld_prop3_'+no+'_'+t+'"'+(s2[2]=='1'?' checked="checked"':'')+'><label for="gis_ol_veld_prop3_'+no+'_'+t+'" style="display: initial;"> rechts</label></td><td>'+Filters.getTypes(t,s2[3],s2[4].split('*'))+'</td>'; if (s[0]=='WMSinput') {html+='<td><select id="gis_ol_veld_inp_'+no+'_'+t+'"><option value="0"'+(s2[5]==0?' selected="selected"':'')+'>- geen -</option><option value="1"'+(s2[5]==1?' selected="selected"':'')+'>Input</option><option value="10"'+(s2[5]==10?' selected="selected"':'')+'>Textarea</option></select></td>';} html+='</tr>'; velden[velden.length]=key; t++; } } html+='</tbody></table><sup>*</sup> Of leeg laten om het veld niet te tonen als de gebruiker op de kaart klikt.<br><br><input class="button" type="button" value="Ok" onclick="gis_ol_velden_modal_close=true; gis_ol_velden_modal.close();"><input class="button" type="button" value="Cancel" onclick=" gis_ol_velden_modal.close();">'; html=jQuery('<div>'+html+'</div>'); gis_ol_velden_modal_close=false; gis_ol_velden_modal = Drupal.dialog(html, { closeOnEscape: true, title:'Veld definities', width: 'auto', beforeClose: function () { if (gis_ol_velden_modal_close) { var t,s='',v1,v2,v3,v4,v5,v6; for (t=0;t<velden.length;t++) { v1=jQuery('#gis_ol_veld_prop_'+no+'_'+t).val(); v1=jQuery.trim(v1); v1=v1.replace(/\|/g,''); v1=v1.replace(/\^/g,''); v1=v1.replace(/,/g,''); v2=jQuery('#gis_ol_veld_prop2_'+no+'_'+t).val(); v2=jQuery.trim(v2); v2=v2.replace(/\|/g,''); v2=v2.replace(/\^/g,''); v2=v2.replace(/,/g,''); v3=jQuery('#gis_ol_veld_prop3_'+no+'_'+t).prop('checked')?1:0; v4=jQuery('#gis_ol_veld_filter_'+t).val(); v5='';t1=1;el=jQuery('#gis_ol_veld_filter'+t1+'_'+t); while (el.length==1) { v5+=(v5==''?'':'*')+el.val(); t1++; el=jQuery('#gis_ol_veld_filter'+t1+'_'+t); } v6=jQuery('#gis_ol_veld_inp_'+no+'_'+t).val(); s+=(s==''?'':',')+velden[t]+'='+v1+'^'+v2+'^'+v3+'^'+v4+'^'+v5+'^'+v6; } gis_ol_setOneValue(no,7,s); } }, }); gis_ol_velden_modal.showModal(); } function gis_ol_setInpWin(row,nn,v) { var el=jQuery('#edit-gis-ol-layer-definities-0-value'),t=el.val(),s; t=t.replace(/[\r\n]+/g,"\r"); t=t.replace(/\n+/g,"\r"); t=t.split("\r"); if (t[row]!='') {s=t[row].split('|');} else {s=gis_ol_default_row;} if (s.length<9) {s[8]='';} var ww=s[8].split('^'); while (ww.length<nn) {ww[ww.length]='';} ww[nn]=v; s[8]=ww.join('^'); t[row]=s.join('|'); t=t.join("\r"); el.val(t); } function gis_ol_setLstyle(row,nn,v) { v=v.replace(/[\r\n]+/g,"\r"); v=v.replace(/\n+/g,"\r"); v=v.split("\r"); v=v.join('[-]'); var el=jQuery('#edit-gis-ol-layer-definities-0-value'),t=el.val(),s; t=t.replace(/[\r\n]+/g,"\r"); t=t.replace(/\n+/g,"\r"); t=t.split("\r"); if (t[row]!='') {s=t[row].split('|');} else {s=gis_ol_default_row;} if (s.length<10) {s[9]='';} var ww=s[9].split('^'); while (ww.length<nn) {ww[ww.length]='';} ww[nn]=v; s[9]=ww.join('^'); t[row]=s.join('|'); t=t.join("\r"); el.val(t); } function gis_ol_setOneValue(row,col,v) { var el=jQuery('#edit-gis-ol-layer-definities-0-value'),t=el.val(),s; t=t.replace(/[\r\n]+/g,"\r"); t=t.replace(/\n+/g,"\r"); t=t.split("\r"); if (t[row]!='') {s=t[row].split('|');} else {s=gis_ol_default_row;} s[col]=v; if (col==0) { switch (s[0]) { case 'WMS': s[1]='https://geodata.rivm.nl/geoserver/wms'; break; case 'WMSinput': s[1]='https://acceptatie.geodata.rivm.nl/geoserver/wfs'; break; case 'datarivmnl': s[1]='https://geodata.rivm.nl/geoserver/wms'; break; case 'Vectortile': s[1]='http://rivm-gistc-l01a.rivm.ssc-campus.nl:8080/geoserver/gwc/service/tms/1.0.0'; break; } } if (col==2) { s[7]=''; } if (col==6) { if (v=='0') { jQuery('#gis_ol_veld_'+row).hide(); } else { jQuery('#gis_ol_veld_'+row).show(); } } t[row]=s.join('|'); t=t.join("\r"); el.val(t); if (col==0) {redrawLayerDefsTable();} } var gis_ol_setLayerRow, gis_ol_modals_close, gis_ol_modals_value; function gis_ol_setLayer(row) { gis_ol_setLayerRow=row; var el=jQuery('#edit-gis-ol-layer-definities-0-value'),t=el.val(),s; t=t.replace(/[\r\n]+/g,"\r"); t=t.replace(/\n+/g,"\r"); t=t.split("\r"); s=t[row].split('|'); gis_ol_modals_close=false; gis_ol_modals_value=t[row]; gis_ol_zoek(s[0].toLowerCase()); gis_ol_modals[s[0]].showModal(); } function gis_ol_add() { var el=jQuery('#edit-gis-ol-layer-definities-0-value'),t=el.val(); t=t.replace(/[\r\n]+/g,"\r"); t=t.replace(/\n+/g,"\r"); t=t.split("\r"); if (t[t.length-1]=='') { t[t.length-1]=gis_ol_default_row.join('|'); } else { t[t.length]=gis_ol_default_row.join('|'); } t=t.join("\r"); el.val(t); redrawLayerDefsTable(); } function gis_ol_delete(row) { var el=jQuery('#edit-gis-ol-layer-definities-0-value'),t=el.val(); t=t.replace(/[\r\n]+/g,"\r"); t=t.replace(/\n+/g,"\r"); t=t.split("\r"); t.splice(row,1); t=t.join("\r"); el.val(t); redrawLayerDefsTable(); } (function($){ gis_ol_init(); regel_p(); regel_fg(); regel_l(); regel_ts(); })(jQuery);